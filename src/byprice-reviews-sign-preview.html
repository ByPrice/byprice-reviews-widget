<!--
@license
Copyright (c) 2017 ByPrice All rights reserved.
-->

<!-- Third party components -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<!-- End - Third party components -->

<!-- Our Behaviors -->
<link rel="import" href="./byprice-reviews-widget-styles.html">
<!-- End - Our Behaviors -->

<!-- Our Components -->
<!-- End - Our Components -->

<dom-module id="byprice-reviews-sign-preview">
  <template>
    <style include="byprice-reviews-widget-styles">
      :host {
        display: block;
      }

      .content {
        width: 100%;
        height: auto;
        background: transparent;
      }

      h3 {
        margin: 0;
        font-weight: 400;
        font-size: 16px;
        color: #989898;
        text-align: center;
      }

      .message-wrapper {
        margin: 20px 0;
        padding: 15px 20px;
        background-color: #fff;
        position: relative;
        border-radius: 5px;
        box-shadow: 0 6px 10px -3px rgba(0, 0, 0, .18);
        border: 1px solid #dadada;
        color: #686868;
      }


      .message-tail {
        width: 20px;
        height: 20px;
        display: block;
        position: absolute;
        bottom: -15px;
        left: calc(50% - 10px);
        transform: rotate(270deg);
      }

      .message-tail svg {
        fill: #fff;
        stroke: #dadada;
        stroke-width: 1px;
      }

      .message-tail::before {
        content: "";
        position: absolute;
        top: 0;
        left: 15px;
        width: 3px;
        height: 20px;
        background: #fff;
      }

      .item figure {
        width: 60px;
        height: 60px;
        margin: 0;
      }

      .item figure img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block;
      }

      .sign button {
        min-width: 90px;
        width: auto;
        max-width: 140px;
        height: 35px;
        margin: 15px 10px 0 0;
        border-radius: 35px;
        padding: 0 5px;
        flex-shrink: 0;
        border: 1px solid transparent;
        outline: none;
        text-align: center;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        outline: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
      }

      .sign button figure {
        width: 15px;
        height: 15px;
        flex-shrink: 0;
        margin: 0 15px;
        padding: 0;
      }

      .sign button figure svg {
        width: 100%;
        height: 100%;
        display: block;
      }

      .sign button span {
        color: white;
        display: inline-block;
        margin: 0 15px 0 0;
        font-size: 14px;
      }

      .opacity {
        opacity: .3;
      }

      .sign-content-option {
        margin: 20px 0;
      }

      button {
        width: 92px;
        height: 35px;
        border: 1px solid transparent;
        background-color: #960062;
        border-radius: 5px;
        outline: none;
        color: white;
        font-size: 14px;
        cursor: pointer;
      }

      input {
        height: 35px;
        padding: 0 15px;
        margin: 0 10px 0 0;
        display: block;
        font-size: 14px;
        outline: none;
        background: white;
        border: 1px solid #dadada;
        border-radius: 5px;
        position: relative;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      small {
        padding: 0 15px;
        display: inline-block;
        color: #989898;
      }

      .edit-wrapper {
        position: absolute;
        flex-shrink: 0;
      }

      .stars-wrapper {
        width: 100%;
      }

      .edit-wrapper {
        cursor: pointer;
        color: #686868;
        font-size: 14px;
      }

      .edit-wrapper figure {
        width: 24px;
        height: 24px;
        fill: #686868;
        margin: 0;
      }

      .edit-wrapper figure svg {
        width: 100%;
        height: 100%;
        display: block;
      }
    </style>


    <div class="content">
      <!-- <div class="item flex flex-v-center">
        <figure>
          <img src$="[[item.image]]">
        </figure>
        <div>[[item.name]]</div>
      </div> -->
      <div class="top-wrapper flex flex-v-center flex-h-end">
        <div class="stars-wrapper flex flex-v-center flex-h-center">
          <template is="dom-repeat" items="[[_stars]]">
            <byprice-rating-star fill="[[item.filled]]"></byprice-rating-star>
          </template>
        </div>
        <div class="edit-wrapper flex flex-v-center flex-h-end" on-tap="_close">
          <figure>
            <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
              width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
              <g>
                <path d="M21.5,3.1l-1.7-1.7c-0.2-0.2-0.2-0.2-0.4-0.2c-0.2,0-0.3,0.1-0.4,0.2L8.9,11.5c-0.1,0.1-0.1,0.2-0.2,0.2
             l-1.1,2.8c-0.2,0.4,0.2,0.8,0.5,0.8c0.1,0,0.2,0,0.2-0.1l2.9-1.2c0.1-0.1,0.2-0.1,0.2-0.2L21.5,3.8C21.7,3.7,21.7,3.3,21.5,3.1z
              M10.7,13.1l-1.5,0.6l0.6-1.5l9.5-9.6l0.9,0.9L10.7,13.1z" />
                <path d="M17,11.3c-0.5,0-0.9,0.4-0.9,0.9v8.7H4.2V4.6h9.1c0.5,0,0.9-0.4,0.9-0.9s-0.4-0.9-0.9-0.9h-10
             c-0.5,0-0.9,0.4-0.9,0.9v18.1c0,0.5,0.4,0.9,0.9,0.9H17c0.5,0,0.9-0.4,0.9-0.9v-9.6C17.8,11.7,17.4,11.3,17,11.3z"
                />
              </g>
            </svg>
          </figure>
          <span>Editar</span>
        </div>
      </div>
      <template is="dom-if" if="[[message]]">
        <div class="message-wrapper no-select">
          <i class="message-tail">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24"
              style="enable-background:new 0 0 24 24;" xml:space="preserve">
              <path d="M20.4,2.3C16.8,8,9.7,10.4,3.6,7.7c0,0,0,0,0,0c1,5.1,4.7,9.9,10.2,12.4c2.2,1,4.4,1.5,6.6,1.6V2.3z" />
            </svg>
          </i>
          <span>[[message]]</span>
        </div>
      </template>
      <h3>¿Con qué cuenta publicamos tu reseña?</h3>
      <div class="sign flex flex-v-center flex-h-center flex-multy">
        <button class$="facebook flex flex-v-center [[_checkActive(_signOption, 'facebook')]]" style="background-color: #3b5998"
          on-tap="_selectSignOption" data-option="facebook">
          <figure class="flex flex-v-center flex-h-center">
            <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
              width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
              <path id="facebook" fill="white" d="M14,9.3h4v4h-4v9.3h-4v-9.3H6v-4h4V7.7c0-1.6,0.5-3.6,1.4-4.8c1.1-1.1,2.3-1.6,3.8-1.6H18v4h-2.8
            c-0.8,0-1.2,0.5-1.2,1.2C14,6.5,14,9.3,14,9.3z" />
            </svg>
          </figure>
          <span>Facebook</span>
        </button>
        <!-- <button class$="google flex flex-v-center  [[_checkActive(_signOption, 'google')]]" style="background-color: #d34836" on-tap="_selectSignOption"
          data-option="google">
          <figure class="flex flex-v-center flex-h-center">
            <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
              width="24px" height="24px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
              <g id="google-plus" fill="white">
                <path d="M11.4,12.9l-0.9-0.7l0,0c-0.3-0.2-0.4-0.4-0.4-0.7c0-0.4,0.2-0.6,0.5-0.8l0,0c1-0.7,2.2-1.6,2.2-3.6c0-1.3-0.6-2.2-1.1-2.8
                  h0.6l2.9-1.6H8.7c-1.2,0-3.1,0.1-4.6,1.4l0,0C3.1,5,2.4,6.3,2.4,7.5c0,1,0.4,2,1.1,2.8c1,1,2.3,1.3,3.2,1.3c0.1,0,0.1,0,0.2,0
                  c-0.1,0.1-0.1,0.3-0.1,0.5c0,0.5,0.1,1,0.4,1.3c-1.2,0.1-2.8,0.3-4.1,1c-1.9,1.1-2.1,2.7-2.1,3.2c0,1.9,1.7,3.7,5.6,3.7
                  c4.4,0,6.7-2.4,6.7-4.8C13.6,14.6,12.4,13.7,11.4,12.9z M5.3,6.3c0-0.7,0.1-1.1,0.4-1.5c0.3-0.4,0.9-0.6,1.4-0.6
                  c1,0,1.6,0.7,1.9,1.3c0.4,0.7,0.7,1.7,0.7,2.6c0,0.2,0,1-0.5,1.4C9,9.9,8.5,10.1,8,10.1c-1,0-1.6-0.7-1.9-1.3
                  C5.5,7.9,5.3,6.9,5.3,6.3z M11.2,17.4c0,1.3-1.2,2.2-3.2,2.2c-2.3,0-3.9-1-3.9-2.5c0-1.3,1-1.8,1.8-2.1c0.9-0.3,2.2-0.4,2.4-0.4
                  c0.2,0,0.3,0,0.4,0C10.6,15.8,11.2,16.3,11.2,17.4z" />
                <polygon points="19.2,6.3 19.2,2.6 17.5,2.6 17.5,6.3 13.6,6.3 13.6,8 17.5,8 17.5,12 19.2,12 19.2,8 22.9,8 22.9,6.3 	" />
              </g>
            </svg>
          </figure>
          <span>Google</span>
        </button> -->
        <button class$="byprice flex flex-v-center  [[_checkActive(_signOption, 'byprice')]]" style="background-color: #960062" on-tap="_selectSignOption"
          data-option="byprice">
          <figure class="flex flex-v-center flex-h-center" style="width: 18px; height: 18px;">
            <svg version="1.1" id="byprice" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
              viewBox="0 0 106 103" style="enable-background:new 0 0 106 103;" xml:space="preserve">
              <style type="text/css">
                .st0 {
                  fill: white;
                }

                .st1 {
                  fill: white;
                }
              </style>
              <g id="iso">
                <path class="st0" d="M95.4,66.5l-8.8-3.8c-1.2-0.5-2.6,0-3.1,1.2c-0.5,1.2,0,2.6,1.2,3.1l2.1,0.9c-2.9,6.1-7.3,11.3-12.9,15.2
                  c-6.4,4.4-14,6.8-21.8,6.8c-21.2,0-38.4-17.2-38.4-38.4c0-21.2,17.2-38.4,38.4-38.4c21.2,0,38.4,17.2,38.4,38.4
                  c0,1.3,1.1,2.4,2.4,2.4c1.3,0,2.4-1.1,2.4-2.4C95.3,27.7,76,8.4,52.2,8.4C28.5,8.4,9.2,27.7,9.2,51.5c0,23.8,19.3,43.1,43.1,43.1
                  c8.8,0,17.3-2.6,24.5-7.6C83,82.6,88,76.7,91.3,69.8l2.3,1c0.3,0.1,0.6,0.2,0.9,0.2c0.9,0,1.8-0.5,2.2-1.4
                  C97.2,68.4,96.6,67,95.4,66.5z" />
                <g>
                  <path class="st1" d="M73.5,53.5c-0.4,0-0.8-0.1-1.2-0.3c-5.8-3.4-11.6-0.1-11.8,0c-1.1,0.6-2.6,0.3-3.2-0.9
                    c-0.6-1.1-0.3-2.5,0.8-3.2c0.3-0.2,8.4-4.8,16.6,0c1.1,0.7,1.5,2.1,0.8,3.2C75.1,53.1,74.3,53.5,73.5,53.5z"
                  />
                </g>
                <g>
                  <circle class="st0" cx="36.5" cy="49.8" r="5" />
                </g>
              </g>
            </svg>
          </figure>
          <span>ByPrice</span>
        </button>
        <button class$="private flex flex-v-center  [[_checkActive(_signOption, 'private')]]" style="background-color: #DADADA" on-tap="_selectSignOption"
          data-option="private">
          <figure class="flex flex-v-center flex-h-center" style="width: 18px; height: 18px;">
            <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
              viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
              <g id="private" fill="#383838">
                <path d="M11.6,13.7h0.7c0.1,1.4,1.2,2.4,2.6,2.4c1.3,0,2.5-1.1,2.6-2.4h0v0c0-0.1,0-0.1,0-0.2h0v-0.4H6.5v0.6h0
                 c0.1,1.4,1.2,2.4,2.6,2.4C10.4,16.1,11.5,15,11.6,13.7z" />
                <path d="M5.7,12c0,0.4,0,0.7,0,1.1c0,2.5,0.6,4.8,1.8,6.5c0.1,0.1,0.2,0.3,0.3,0.4c0,0,0,0,0,0c1.1,1.6,2.7,2.5,4.4,2.5
                 c1.7,0,3.2-1,4.4-2.5c0,0,0,0,0,0c0.1-0.1,0.2-0.2,0.3-0.4c1.2-1.7,1.8-4,1.8-6.5c0-0.4,0-0.8,0-1.1c2.5-0.5,4.2-1.3,4.2-2.2
                 c0-1-2.2-1.9-5.4-2.4c-0.1-0.5-0.1-1.1-0.1-1.7c0-2.3-0.7-4.1-2.6-4.1c-2.2,0-1.7,2.5-2.5,2.6C11.2,4,11.7,1.5,9.5,1.5
                 c-1.9,0-2.6,1.8-2.6,4.1c0,0.6-0.1,1.2-0.1,1.7C3.6,7.8,1.5,8.7,1.5,9.7C1.5,10.6,3.1,11.5,5.7,12z M12,21.5
                 c-3.1,0-5.5-3.7-5.5-8.4c0-0.3,0-0.7,0-1c1.6,0.3,3.5,0.4,5.5,0.4c2,0,3.9-0.1,5.5-0.4c0,0.3,0,0.6,0,1
                 C17.5,17.8,15.1,21.5,12,21.5z M6.4,8c0,0,0,0.1,0,0.1c0,0.9,2.5,1.7,5.7,1.7c3.1,0,5.7-0.8,5.7-1.7c0,0,0-0.1,0-0.1
                 c0.4,0.3,0.7,0.5,0.7,0.9c0,1.1-2.8,1.9-6.3,1.9S5.7,9.9,5.7,8.8C5.7,8.5,5.9,8.2,6.4,8z" />
              </g>
            </svg>

          </figure>
          <span style="color: #383838">Invitado</span>
        </button>
      </div>

      <div class="sign-content">
        <!-- Byprice -->
        <template is="dom-if" if="[[_signOption.byprice]]">
          <div class="sign-content-option">
            <form class="flex flex-v-start" on-submit="_onSubmit" data-form="byprice">
              <label>
                <input id="Email" type="email" placeholder="Correo electrónico" required />
              </label>
              <label>
                <input id="Password" type="password" placeholder="Contraseña" required/>
              </label>
              <button type="submit">Publicar</button>
            </form>
          </div>
        </template>
        <!--End - Byprice -->
        <!-- Private -->
        <template is="dom-if" if="[[_signOption.private]]">
          <div class="sign-content-option">
            <form class="flex flex-v-start" on-submit="_onSubmit" data-form="private">
              <label>
                <input id="Name" type="name" placeholder="Nombre" />
                <small>Opcional</small>
              </label>
              <label>
                <input id="PrivateEmail" type="email" placeholder="Correo electrónico" required/>
              </label>
              <button type="submit">Publicar</button>
            </form>
          </div>
        </template>
        <!--End - Private -->
      </div>
    </div>

  </template>

  <script>
    /**
     * Class for byprice custom <byprice-reviews-sign-preview></<byprice-reviews-sign-preview>
     */
    class ByPriceReviewsSignPreview extends Polymer.GestureEventListeners(Polymer.Element) {
      /**
       * Returns component name
       */
      static get is() {
        return 'byprice-reviews-sign-preview';
      }

      /**
       * Fired when user sends private or byprice form
       * @event submit-sign
       */
      /**
       * Declare properties for the element's public API
       */
      static get properties() {
        return {
          message: {
            type: String
          },
          rating: {
            type: Number,
            observer: '_watchRating',
            value: 0
          },
          showPreview: {
            type: Boolean,
            notify: true
          },
          /* Private */
          _activeOption: {
            type: Object,
            value: false
          },
          _signOption: {
            type: Object,
            value: {
              // byprice: true
            }
          }
        }
      }

      /**
       * Legacy callback Called after property values are set and local DOM is initialized.
       */
      ready() {
        super.ready();
      }

      _selectSignOption(e) {
        if (!e.currentTarget.dataset || !e.currentTarget.dataset.option) return;
        var signOption = {};
        signOption[e.currentTarget.dataset.option] = true
        this.set('_signOption', signOption);
      }

      _checkActive(signOption, option) {
        var d = Object.keys(signOption);
        if (!d.length) return '';
        return signOption[option] ? '' : 'opacity';
      }

      _close() {
        this.set('showPreview', !this.showPreview);
      }

      _watchRating(rating) {
        if (!rating) return;
        var _stars = [];
        for (var i = 0; i < rating; i++) {
          _stars.push({
            filled: i <= rating
          });
        }
        this.set('_stars', _stars);
      }

      _onSubmit(e) {
        e.preventDefault();
        e.stopPropagation();
        var form = e.currentTarget.dataset.form;
        var data = {
          form: form,
          password: (this.shadowRoot.getElementById('Password') || {}).value,
          name: (this.shadowRoot.getElementById('Name') || {}).value,
          email: (this.shadowRoot.getElementById(form === 'byprice' ? 'Email' : 'PrivateEmail') || {}).value
        }
        this.dispatchEvent(new CustomEvent('submit-sign', {
          detail: data
        }));
      }

    }

    window.customElements.define(ByPriceReviewsSignPreview.is, ByPriceReviewsSignPreview);
  </script>
</dom-module>